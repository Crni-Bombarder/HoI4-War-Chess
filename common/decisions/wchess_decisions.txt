@B_KING   = 1
@W_KING   = 2
@B_QUEEN  = 3
@W_QUEEN  = 4
@B_BISHOP = 5
@W_BISHOP = 6
@B_ROOK   = 7
@W_ROOK   = 8
@B_KNIGHT = 9
@W_KNIGHT = 10
@B_PAWN   = 11
@W_PAWN   = 12
@EMPTY    = 13

@ID_KING   = 0
@ID_QUEEN  = 1
@ID_BISHOP = 2
@ID_ROOK   = 3
@ID_KNIGHT = 4
@ID_PAWN   = 5

@BLACK = 0
@WHITE = 1

@ACTIVATE = 1
@DEACTIVATE = 2

@S_SELECTION = 0
@S_MOVE      = 1

wchess_decision_categories = {
    wchess_challenge = {
        state_target = yes
        on_map_mode = map_only
        visible = {
            is_ai = no
            AND = {
                NOT = {
                    has_variable = ROOT.wchess_challenged
                }
                NOT = {
                    has_variable = ROOT.wchess_challenger
                }
            }
        }
        target_root_trigger = {
            AND = {
                NOT = {
                    has_variable = ROOT.wchess_challenged
                }
                NOT = {
                    has_variable = ROOT.wchess_challenger
                }
            }
        }
        target_trigger = {
            FROM = {
                is_capital = yes
                owner = {
                    is_neighbor_of = ROOT
                    AND = {
                        NOT = {
                            has_variable = ROOT.wchess_challenged
                        }
                        NOT = {
                            has_variable = ROOT.wchess_challenger
                        }
                    }
                }
            }
        }
        complete_effect = {
            FROM = {
                owner = {
                    set_variable = {
                        var = ROOT.wchess_challenger
                        value = THIS
                    }
                    set_variable = {
                        var = THIS.wchess_challenged
                        value = ROOT
                    }

                    # DEBUG : Force the game to start
                    ## The challenged start with the black
                    #set_variable = {
                    #    var = THIS.wchess_start_game
                    #    value = 1
                    #}
                    #set_variable = {
                    #    var = THIS.wchess_color
                    #    value = @WHITE
                    #}
                    #set_variable = {
                    #    var = THIS.wchess_opponent
                    #    value = ROOT
                    #}
                    #clear_variable = THIS.wchess_game_turn
                    # The challenger start with the white
                    set_variable = {
                        var = ROOT.wchess_start_game
                        value = 1
                    }
                    set_variable = {
                        var = ROOT.wchess_color
                        value = @WHITE
                    }
                    set_variable = {
                        var = ROOT.wchess_opponent
                        value = ROOT
                    }
                    set_variable = {
                        var = ROOT.wchess_game_turn
                        value = 1
                    }
                    set_variable = {
                        var = ROOT.wchess_play_state
                        value = @S_SELECTION
                    }

                    wchess_create_board = yes
                }
            }
        }
    }

    # DEBUG : bypass for now
    wchess_mission_challenged = {
        days_mission_timeout = 7
        selectable_mission = yes
        visible = {
            #has_variable = ROOT.wchess_challenged
            always = no
        }
        activation = {
            #has_variable = ROOT.wchess_challenged
            always = no
        }
        complete_effect = {
            country_event = wchess_events.1
        }
        timeout_effect = {
            var:ROOT.wchess_challenged = {
                country_event = wchess_events.2
            }
        }
    }

    wchess_debug_clr_variable = {
        complete_effect = {
            every_country = {
                clear_variable = THIS.wchess_challenged
                clear_variable = THIS.wchess_challenger
                clear_variable = THIS.wchess_shamed
                clear_variable = THIS.wchess_has_shamed
                clear_variable = THIS.wchess_start_game
                clear_variable = THIS.wchess_color
                clear_variable = THIS.wchess_opponent
            }
        }
    }

    wchess_debug_display_gui = {
        complete_effect = {
            set_variable = {
                var = ROOT.wchess_debug_show_gui
                value = ROOT
            }
        }
    }

    wchess_debug_hide_gui = {
        complete_effect = {
            clear_variable = ROOT.wchess_debug_show_gui
        }
    }
}